---
date: '2011-05-26T05:40:00.000-07:00'
description: ''
published: true
slug: 2011-05-python-http-requests-for-humans
tags:
- rant
- python
- legacy
time_to_read: 5
title: Python HTTP Requests for Humans
---

Ever try to use <a href="http://python.org/">Python's</a> standard library for doing a <a href="http://en.wikipedia.org/wiki/POST_(HTTP)">POST</a>? Or a <a href="http://en.wikipedia.org/wiki/GET_(HTTP)">GET</a>,&nbsp;<a href="http://en.wikipedia.org/wiki/PUT_(HTTP)">PUT</a>, or <a href="http://en.wikipedia.org/wiki/DELETE_(HTTP)">DELETE</a>? What about when you have to deal with&nbsp;<a href="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Auth</a>?<br /><br />In a word, ugh.<br /><br />Let's face it, this is one part of Python that is really not for human consumption. While there are a million things you can do with things like&nbsp;<a href="http://docs.python.org/library/urllib.html">urllib</a>,&nbsp;<a href="http://docs.python.org/library/urllib2.html">urllib2</a>,&nbsp;<a href="http://docs.python.org/library/socket.html">socket</a>,&nbsp;<a href="http://docs.python.org/library/urlparse.html">urlparse</a>, the fact of the matter is that implementing anything beyond <b>urllib.urlopen()</b> is a matter of diving into arcane APIs.<br /><br />Sure, thanks to works like <a href="http://www.doughellmann.com/PyMOTW/">Doug Hellmann's Python Module of the Week</a>&nbsp;and <a href="http://www.voidspace.org.uk/python/articles/urllib2.shtml">Michael Foord's documentation of urllib2</a>&nbsp;the problem isn't unsurmountable. Unfortunately, the eclectic mix of libraries and weird APIs means when you have to revisit your code in a few months your code feels like spaghetti.<br /><br />Do you doubt me?<br /><br /><pre class="prettyprint lang-py"># This sample gleefully taken from https://gist.github.com/973705<br /><br />import urllib2<br /><br />gh_url = 'https://api.github.com'<br />gh_user= 'user'<br />gh_pass = 'pass'<br /><br />req = urllib2.Request(gh_url)<br /><br />password_manager = urllib2.HTTPPasswordMgrWithDefaultRealm()<br />password_manager.add_password(None, gh_url, gh_user, gh_pass)<br /><br />auth_manager = urllib2.HTTPBasicAuthHandler(password_manager)<br />opener = urllib2.build_opener(auth_manager)<br /><br />urllib2.install_opener(opener)<br /><br />handler = urllib2.urlopen(req)<br /><br />print handler.getcode()<br />print handler.headers.getheader('content-type')<br /><br /># ------<br /># 200<br /># 'application/json'</pre><br />Really?<br /><br />This much code to make a simple HTTP GET request with some auth?!?<br /><br /><b>Really?!?</b><br /><br />This is a debugging nightmare! Especially when you have to deal with complex service APIs provided by Paypal, Amazon, Google, Authorize.net, and a million other systems.<br /><br />I bet I could earn a decent living by charging Pythonistas a buck each time they took the shortcut of doing HTTP actions in the shell via curl or wget. <br /><br />Anyway, wouldn't it be great if we could just call a single function with the URL and auth data as parameters? And that the same dialogue would exist for GET, POST, PUT, DELETE or whatever? Wouldn't that be just plain wonderful? If only we could have that functionality in Python!!!<br /><br />Fortunately for us, we do have that functionality courtesy of <a href="http://kennethreitz.com/">Kenneth Reitz</a>'s <a href="http://pypi.python.org/pypi/requests">Requests</a> library! Our verbose code sample above becomes the wonderfully terse and easy-to-memorize script as shown below:<br /><br /><pre class="prettyprint lang-py"># This sample joyfully taken from https://gist.github.com/973705<br /><br />import requests<br /><br />r = requests.get('https://api.github.com', auth=('user', 'pass'))<br /><br />print r.status_code<br />print r.headers['content-type']<br /><br /># ------<br /># 200<br /># 'application/json'</pre><br />Want to do a post with data? Try this:<br /><br /><pre class="prettyprint lang-py"># This example cooked up by me!<br /><br />import requests<br />post_data = {"amount":10000, "service":"writing blog posts"}<br /><br />r = requests.post('http://example.com/api', post_data, auth=('user', 'pass'))<br /><br />print r.status_code<br />print r.headers['content-type']<br /><br /># ------<br /># 200<br /># 'application/json'</pre><br />The <a href="https://github.com/kennethreitz/requests">Requests</a> library is still young, but I've yet to run into any bugs or undocumented edge cases. The <a href="http://docs.python-requests.org/en/latest/index.html">documentation is awesome</a>, but you don't really need it at all. The library is intuitive, fun, and and there is clearly one way to do.